<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>1 Chapter 11: Why model? | Coding Causal Inference in R</title>
  <meta name="description" content="1 Chapter 11: Why model? | Coding Causal Inference in R">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="1 Chapter 11: Why model? | Coding Causal Inference in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Chapter 11: Why model? | Coding Causal Inference in R" />
  
  
  



<meta name="date" content="2019-03-29">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="chapter-12.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Causal Inference Notebook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="chapter-11-why-model.html"><a href="chapter-11-why-model.html"><i class="fa fa-check"></i><b>1</b> Chapter 11: Why model?</a><ul>
<li class="chapter" data-level="1.1" data-path="chapter-11-why-model.html"><a href="chapter-11-why-model.html#program-11.1"><i class="fa fa-check"></i><b>1.1</b> Program 11.1</a></li>
<li class="chapter" data-level="1.2" data-path="chapter-11-why-model.html"><a href="chapter-11-why-model.html#program-11.2"><i class="fa fa-check"></i><b>1.2</b> Program 11.2</a></li>
<li class="chapter" data-level="1.3" data-path="chapter-11-why-model.html"><a href="chapter-11-why-model.html#program-11.3"><i class="fa fa-check"></i><b>1.3</b> Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-12.html"><a href="chapter-12.html"><i class="fa fa-check"></i><b>2</b> Chapter 12</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-12.html"><a href="chapter-12.html#program-12.1"><i class="fa fa-check"></i><b>2.1</b> Program 12.1</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-12.html"><a href="chapter-12.html#program-12.2"><i class="fa fa-check"></i><b>2.2</b> Program 12.2</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-12.html"><a href="chapter-12.html#program-12.3"><i class="fa fa-check"></i><b>2.3</b> Program 12.3</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-12.html"><a href="chapter-12.html#program-12.4"><i class="fa fa-check"></i><b>2.4</b> Program 12.4</a></li>
<li class="chapter" data-level="2.5" data-path="chapter-12.html"><a href="chapter-12.html#program-12.5"><i class="fa fa-check"></i><b>2.5</b> Program 12.5</a></li>
<li class="chapter" data-level="2.6" data-path="chapter-12.html"><a href="chapter-12.html#program-12.6"><i class="fa fa-check"></i><b>2.6</b> Program 12.6</a></li>
<li class="chapter" data-level="2.7" data-path="chapter-12.html"><a href="chapter-12.html#program-12.7"><i class="fa fa-check"></i><b>2.7</b> Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-13.html"><a href="chapter-13.html"><i class="fa fa-check"></i><b>3</b> Chapter 13</a></li>
<li class="chapter" data-level="4" data-path="program-13-1.html"><a href="program-13-1.html"><i class="fa fa-check"></i><b>4</b> Program 13.1</a></li>
<li class="chapter" data-level="5" data-path="program-13-2.html"><a href="program-13-2.html"><i class="fa fa-check"></i><b>5</b> Program 13.2</a></li>
<li class="chapter" data-level="6" data-path="program-13-3.html"><a href="program-13-3.html"><i class="fa fa-check"></i><b>6</b> Program 13.3</a></li>
<li class="chapter" data-level="7" data-path="program-13-4.html"><a href="program-13-4.html"><i class="fa fa-check"></i><b>7</b> Program 13.4</a></li>
<li class="chapter" data-level="8" data-path="chapter-14.html"><a href="chapter-14.html"><i class="fa fa-check"></i><b>8</b> Chapter 14</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-14.html"><a href="chapter-14.html#program-14.1"><i class="fa fa-check"></i><b>8.1</b> Program 14.1</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-14.html"><a href="chapter-14.html#program-14.2"><i class="fa fa-check"></i><b>8.2</b> Program 14.2</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-14.html"><a href="chapter-14.html#program-14.3"><i class="fa fa-check"></i><b>8.3</b> Program 14.3</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-15.html"><a href="chapter-15.html"><i class="fa fa-check"></i><b>9</b> Chapter 15</a></li>
<li class="chapter" data-level="10" data-path="chapter-16.html"><a href="chapter-16.html"><i class="fa fa-check"></i><b>10</b> Chapter 16</a></li>
<li class="chapter" data-level="11" data-path="chapter-17.html"><a href="chapter-17.html"><i class="fa fa-check"></i><b>11</b> Chapter 17</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Coding Causal Inference in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-11-why-model" class="section level1">
<h1><span class="header-section-number">1</span> Chapter 11: Why model?</h1>
<p>This is the code for Chapter 11. Throughout this chapter and the rest of the book, we’ll use the tidyverse metapackage to load the core tidyverse packages, as well the broom package. In this chapter, the main packages we’ll be using are ggplot2 for data visualization, dplyr for data manipulation, and broom for <a href="https://r4ds.had.co.nz/tidy-data.html">tidying</a> regression model results.</p>
<div id="program-11.1" class="section level2">
<h2><span class="header-section-number">1.1</span> Program 11.1</h2>
<p>To replicate Program 11.1, we first need to create the data set, <code>binary_a_df</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(broom)

binary_a_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>), <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">8</span>)),
  <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">150</span>, <span class="dv">220</span>, <span class="dv">110</span>, <span class="dv">50</span>, <span class="dv">180</span>, <span class="dv">90</span>, <span class="dv">170</span>, 
        <span class="dv">170</span>, <span class="dv">30</span>, <span class="dv">70</span>, <span class="dv">110</span>, <span class="dv">80</span>, <span class="dv">50</span>, <span class="dv">10</span>, <span class="dv">20</span>)
)

<span class="kw">ggplot</span>(binary_a_df, <span class="kw">aes</span>(a, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#E69F00&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">expand =</span> <span class="kw">expand_scale</span>(.<span class="dv">5</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">20</span>)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="causal_inference_book_files/figure-html/unnamed-chunk-1-1.png" alt="Figure 11.1" width="672" />
<p class="caption">
FIGURE 1.1: Figure 11.1
</p>
</div>
<p>To summarize the data, we’ll use dplyr to group the dataset by <code>a</code>, then get the sample size, mean, standard deviation, and range. <code>knitr::kable()</code> is used to print the results nicely to a table. (For more information on the <code>%&gt;%</code> pipe operator, see <a href="https://r4ds.had.co.nz/pipes.html">R for Data Science</a>.)</p>
<pre class="sourceCode r"><code class="sourceCode r">binary_a_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(a) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(
    <span class="dt">n =</span> <span class="kw">n</span>(), 
    <span class="dt">mean =</span> <span class="kw">mean</span>(y), 
    <span class="dt">sd =</span> <span class="kw">sd</span>(y), 
    <span class="dt">minimum =</span> <span class="kw">min</span>(y), 
    <span class="dt">maximum =</span> <span class="kw">max</span>(y)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">a</th>
<th align="right">n</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">minimum</th>
<th align="right">maximum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">8</td>
<td align="right">67.50</td>
<td align="right">53.12</td>
<td align="right">10</td>
<td align="right">170</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">8</td>
<td align="right">146.25</td>
<td align="right">58.29</td>
<td align="right">50</td>
<td align="right">220</td>
</tr>
</tbody>
</table>
<p>Similarly, we’ll plot and summarize <code>categorical_a_df</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">categorical_a_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="kw">sort</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">4</span>)),
                               <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">110</span>, <span class="dv">80</span>, <span class="dv">50</span>, <span class="dv">40</span>, <span class="dv">170</span>, <span class="dv">30</span>, <span class="dv">70</span>, <span class="dv">50</span>, 
                                     <span class="dv">110</span>, <span class="dv">50</span>, <span class="dv">180</span>, <span class="dv">130</span>, <span class="dv">200</span>, <span class="dv">150</span>, <span class="dv">220</span>, <span class="dv">210</span>))

<span class="kw">ggplot</span>(categorical_a_df, <span class="kw">aes</span>(a, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#E69F00&quot;</span>,  <span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">expand =</span> <span class="kw">expand_scale</span>(.<span class="dv">25</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">20</span>)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-2"></span>
<img src="causal_inference_book_files/figure-html/unnamed-chunk-2-1.png" alt="Figure 11.2" width="672" />
<p class="caption">
FIGURE 1.2: Figure 11.2
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">categorical_a_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(a) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(
    <span class="dt">n =</span> <span class="kw">n</span>(), 
    <span class="dt">mean =</span> <span class="kw">mean</span>(y), 
    <span class="dt">sd =</span> <span class="kw">sd</span>(y), 
    <span class="dt">minimum =</span> <span class="kw">min</span>(y), 
    <span class="dt">maximum =</span> <span class="kw">max</span>(y)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">a</th>
<th align="right">n</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">minimum</th>
<th align="right">maximum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">4</td>
<td align="right">70.0</td>
<td align="right">31.62</td>
<td align="right">40</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">4</td>
<td align="right">80.0</td>
<td align="right">62.18</td>
<td align="right">30</td>
<td align="right">170</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">117.5</td>
<td align="right">53.77</td>
<td align="right">50</td>
<td align="right">180</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">4</td>
<td align="right">195.0</td>
<td align="right">31.09</td>
<td align="right">150</td>
<td align="right">220</td>
</tr>
</tbody>
</table>
</div>
<div id="program-11.2" class="section level2">
<h2><span class="header-section-number">1.2</span> Program 11.2</h2>
<p>Program 11.2 uses a continuous exposure and outcome data, <code>continuous_a_df</code>. Plotting the points is similar to above.</p>
<pre class="sourceCode r"><code class="sourceCode r">continuous_a_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">23</span>, <span class="dv">29</span>, <span class="dv">37</span>, <span class="dv">41</span>, <span class="dv">53</span>, 
        <span class="dv">67</span>, <span class="dv">79</span>, <span class="dv">83</span>, <span class="dv">97</span>, <span class="dv">60</span>, <span class="dv">71</span>, <span class="dv">15</span>, <span class="dv">45</span>),
  <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">54</span>, <span class="dv">33</span>, <span class="dv">101</span>, <span class="dv">85</span>, <span class="dv">65</span>, <span class="dv">157</span>, <span class="dv">120</span>, 
        <span class="dv">111</span>, <span class="dv">200</span>, <span class="dv">140</span>, <span class="dv">220</span>, <span class="dv">230</span>, <span class="dv">217</span>, <span class="dv">11</span>, <span class="dv">190</span>)
)

<span class="kw">ggplot</span>(continuous_a_df, <span class="kw">aes</span>(a, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#E69F00&quot;</span>,  <span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">20</span>)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="causal_inference_book_files/figure-html/unnamed-chunk-4-1.png" alt="Figure 11.3" width="672" />
<p class="caption">
FIGURE 1.3: Figure 11.3
</p>
</div>
<p>We’ll also add a regression line using <code>geom_smooth()</code> with <code>method = &quot;lm&quot;</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(continuous_a_df, <span class="kw">aes</span>(a, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey85&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="st">&quot;#E69F00&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">20</span>) </code></pre>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="causal_inference_book_files/figure-html/unnamed-chunk-5-1.png" alt="Figure 11.4" width="672" />
<p class="caption">
FIGURE 1.4: Figure 11.4
</p>
</div>
<p>To fit an OLS regression model of <code>a</code> on <code>y</code>, we’ll use<code>lm()</code> and then tidy the results with <code>tidy()</code> from the broom package.</p>
<pre class="sourceCode r"><code class="sourceCode r">linear_regression &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>a, <span class="dt">data =</span> continuous_a_df)

linear_regression <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># get the confidence intervals using `conf.int = TRUE`</span>
<span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># drop the test statistic and P-value</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>statistic, <span class="op">-</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">24.55</td>
<td align="right">21.33</td>
<td align="right">-21.20</td>
<td align="right">70.29</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">2.14</td>
<td align="right">0.40</td>
<td align="right">1.28</td>
<td align="right">2.99</td>
</tr>
</tbody>
</table>
<p>To predict a value of <code>y</code> for when <code>a = 90</code>, we pass the linear regression model object <code>linear_regression</code> to the <code>predict()</code> function. We also give it a new data frame that contains only one value, <code>a = 90</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">linear_regression <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">predict</span>(<span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">90</span>))</code></pre>
<pre><code>##      1 
## 216.89</code></pre>
<p>Similarly, using <code>binary_a_df</code>, which has a treatmant <code>a</code> that is a binary:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>a, <span class="dt">data =</span> binary_a_df) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st">   </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>statistic, <span class="op">-</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">67.50</td>
<td align="right">19.72</td>
<td align="right">25.21</td>
<td align="right">109.79</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">78.75</td>
<td align="right">27.88</td>
<td align="right">18.95</td>
<td align="right">138.55</td>
</tr>
</tbody>
</table>
</div>
<div id="program-11.3" class="section level2">
<h2><span class="header-section-number">1.3</span> Program 11.3</h2>
<p>Fitting and tidying a quadratic version of <code>a</code> is similar, but we use <code>I()</code> to include <code>a^2</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">smoothed_regression &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(a<span class="op">^</span><span class="dv">2</span>), <span class="dt">data =</span> continuous_a_df) 

smoothed_regression <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>statistic, <span class="op">-</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co">#  remove `I()` from the term name</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">ifelse</span>(term <span class="op">==</span><span class="st"> &quot;I(a^2)&quot;</span>, <span class="st">&quot;a^2&quot;</span>, term)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>) </code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-7.41</td>
<td align="right">31.75</td>
<td align="right">-75.99</td>
<td align="right">61.18</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">4.11</td>
<td align="right">1.53</td>
<td align="right">0.80</td>
<td align="right">7.41</td>
</tr>
<tr class="odd">
<td align="left">a^2</td>
<td align="right">-0.02</td>
<td align="right">0.02</td>
<td align="right">-0.05</td>
<td align="right">0.01</td>
</tr>
</tbody>
</table>
<p>To plot the quadratic function, we give <code>geom_smooth()</code> a <code>formula</code> argument: <code>formula = y ~ x + I(x^2)</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(continuous_a_df, <span class="kw">aes</span>(a, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey85&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="st">&quot;#E69F00&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x<span class="op">^</span><span class="dv">2</span>), <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">20</span>) </code></pre>
<div class="figure"><span id="fig:unnamed-chunk-10"></span>
<img src="causal_inference_book_files/figure-html/unnamed-chunk-10-1.png" alt="Figure 11.5" width="672" />
<p class="caption">
FIGURE 1.5: Figure 11.5
</p>
</div>
<p>But predicting is done the same way.</p>
<pre class="sourceCode r"><code class="sourceCode r">smoothed_regression <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">predict</span>(<span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">90</span>))</code></pre>
<pre><code>##        1 
## 197.1269</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-12.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/malcolmbarrett/causal_inference_book/blob/master/chapter11.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
